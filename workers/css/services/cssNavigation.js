!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","vscode-languageserver-types","vscode-nls","../parser/cssNodes","../parser/cssSymbolScope","../languageFacts/facts","../utils/strings"],e)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("vscode-languageserver-types"),r=e("vscode-nls"),a=e("../parser/cssNodes"),o=e("../parser/cssSymbolScope"),i=e("../languageFacts/facts"),s=e("../utils/strings"),u=r.loadMessageBundle(),c=function(){function e(){}return e.prototype.findDefinition=function(e,t,n){var r=new o.Symbols(n),i=e.offsetAt(t),s=a.getNodeAtOffset(n,i);if(!s)return null;var u=r.findSymbolFromNode(s);return u?{uri:e.uri,range:p(u.node,e)}:null},e.prototype.findReferences=function(e,t,n){return this.findDocumentHighlights(e,t,n).map((function(t){return{uri:e.uri,range:t.range}}))},e.prototype.findDocumentHighlights=function(e,t,n){var r=[],i=e.offsetAt(t),s=a.getNodeAtOffset(n,i);if(!s||s.type===a.NodeType.Stylesheet||s.type===a.NodeType.Declarations)return r;s.type===a.NodeType.Identifier&&s.parent&&s.parent.type===a.NodeType.ClassSelector&&(s=s.parent);var u=new o.Symbols(n),c=u.findSymbolFromNode(s),l=s.getText();return n.accept((function(t){if(c){if(u.matchesSymbol(t,c))return r.push({kind:d(t),range:p(t,e)}),!1}else s.type===t.type&&s.length===t.length&&l===t.getText()&&r.push({kind:d(t),range:p(t,e)});return!0})),r},e.prototype.findDocumentLinks=function(e,t,n){var r=[];return t.accept((function(t){if(t.type===a.NodeType.URILiteral){var o=function(e,t,n){if(0===t.getChildren().length)return null;var r=t.getChild(0);return l(e,r,n)}(e,t,n);return o&&r.push(o),!1}if(t.parent&&t.parent.type===a.NodeType.Import){var i=t.getText();return(s.startsWith(i,"'")||s.startsWith(i,'"'))&&r.push(l(e,t,n)),!1}return!0})),r},e.prototype.findDocumentSymbols=function(e,t){var r=[];return t.accept((function(t){var o={name:null,kind:n.SymbolKind.Class,location:null},i=t;return t instanceof a.Selector?(o.name=t.getText(),(i=t.findAParent(a.NodeType.Ruleset,a.NodeType.ExtendsReference))&&(o.location=n.Location.create(e.uri,p(i,e)),r.push(o)),!1):(t instanceof a.VariableDeclaration?(o.name=t.getName(),o.kind=n.SymbolKind.Variable):t instanceof a.MixinDeclaration?(o.name=t.getName(),o.kind=n.SymbolKind.Method):t instanceof a.FunctionDeclaration?(o.name=t.getName(),o.kind=n.SymbolKind.Function):t instanceof a.Keyframe?o.name=u("literal.keyframes","@keyframes {0}",t.getName()):t instanceof a.FontFace&&(o.name=u("literal.fontface","@font-face")),o.name&&(o.location=n.Location.create(e.uri,p(i,e)),r.push(o)),!0)})),r},e.prototype.findDocumentColors=function(e,t){var n=[];return t.accept((function(t){var r=function(e,t){var n=i.getColorValue(e);if(n){var r=p(e,t);return{color:n,range:r}}return null}(t,e);return r&&n.push(r),!0})),n},e.prototype.getColorPresentations=function(e,t,r,a){var o,s=[],u=Math.round(255*r.red),c=Math.round(255*r.green),l=Math.round(255*r.blue);o=1===r.alpha?"rgb("+u+", "+c+", "+l+")":"rgba("+u+", "+c+", "+l+", "+r.alpha+")",s.push({label:o,textEdit:n.TextEdit.replace(a,o)}),o=1===r.alpha?"#"+f(u)+f(c)+f(l):"#"+f(u)+f(c)+f(l)+f(Math.round(255*r.alpha)),s.push({label:o,textEdit:n.TextEdit.replace(a,o)});var p=i.hslFromColor(r);return o=1===p.a?"hsl("+p.h+", "+Math.round(100*p.s)+"%, "+Math.round(100*p.l)+"%)":"hsla("+p.h+", "+Math.round(100*p.s)+"%, "+Math.round(100*p.l)+"%, "+p.a+")",s.push({label:o,textEdit:n.TextEdit.replace(a,o)}),s},e.prototype.doRename=function(e,t,r,a){var o,i=this.findDocumentHighlights(e,t,a).map((function(e){return n.TextEdit.replace(e.range,r)}));return{changes:(o={},o[e.uri]=i,o)}},e}();function l(e,t,n){var r=t.getText(),o=p(t,e);return o.start.line===o.end.line&&o.start.character===o.end.character?null:((s.startsWith(r,"'")||s.startsWith(r,'"'))&&(r=r.slice(1,-1)),{range:o,target:s.startsWith(r,"http://")||s.startsWith(r,"https://")?r:/^\w+:\/\//g.test(r)?r:"scss"===e.languageId?s.endsWith(r,".css")||s.startsWith(r,"http://")||s.startsWith(r,"https://")||t.parent&&t.parent.type===a.NodeType.URILiteral||1!==t.parent.getChildren().length?n.resolveReference(r,e.uri):n.resolveReference(r,e.uri).replace(/\/(\w+)(.scss)?$/gm,(function(e,t){return"/_"+t+".scss"})):n.resolveReference(r,e.uri)})}function p(e,t){return n.Range.create(t.positionAt(e.offset),t.positionAt(e.end))}function d(e){if(e.type===a.NodeType.Selector)return n.DocumentHighlightKind.Write;if(e instanceof a.Identifier&&e.parent&&e.parent instanceof a.Property&&e.isCustomProperty)return n.DocumentHighlightKind.Write;if(e.parent)switch(e.parent.type){case a.NodeType.FunctionDeclaration:case a.NodeType.MixinDeclaration:case a.NodeType.Keyframe:case a.NodeType.VariableDeclaration:case a.NodeType.FunctionParameter:return n.DocumentHighlightKind.Write}return n.DocumentHighlightKind.Read}function f(e){var t=e.toString(16);return 2!==t.length?"0"+t:t}t.CSSNavigation=c}));